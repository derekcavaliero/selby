!function(a,b,c,d){function e(b,c){this.element=a(b),this.options=a.extend(!0,{},g,c),this._defaults=g,this._fields=this.options.fields,this._questions=this.options.questions,this._name=f,this._tpl=h,this._storage={},console.log(this),this.init()}var f="selby",g={botName:"Selby",fields:{name:{type:"text",placeholder:"First and last name"}},questions:{start:{bot:"Hey there, I'm {{botName}}! I might look like Derek, but im just a machine living in a human's world. <strong>Now that you know my name, what's yours?</strong>",prompt:"Hey {{botName}}, nice to meet you!<br> <strong>My name is</strong>",fields:["name"]}}},h={bot:Handlebars.compile('<div class="bubble bubble--bot"><div class="bubble__inner">{{{smartString bot userInput}}}</div></div>'),user:Handlebars.compile('<form class="bubble bubble--user"><div class="bubble__inner">{{{ smartString prompt userInput }}}{{{fields}}}<input type="hidden" name="step" value="{{stepKey}}"></div></form>')};e.prototype.init=function(){var a=this;Handlebars.registerHelper("smartString",function(b,c){for(var d in c)c.hasOwnProperty(d)&&(b=b.replace("{{"+d+"}}","<mark>"+c[d]+"</mark>"));return b=b.replace("{{botName}}",a.options.botName),new Handlebars.SafeString(b)}),this.element.addClass("selby"),this.setupListeners(),this.renderStep()},e.prototype.serializeObject=function(b){var c={},d=b.serializeArray();return a.each(d,function(){c[this.name]?(c[this.name].push||(c[this.name]=[c[this.name]]),c[this.name].push(this.value||"")):c[this.name]=this.value||""}),c},e.prototype.setupListeners=function(){var b=this;this.element.on("submit",".bubble--user",function(c){c.preventDefault();var d=a(this),e=b.serializeObject(d);b._storage=a.extend({},b._storage,b.transformInput(e)),console.log(b._storage),d.find(".bubble__input").prop("disabled",!0),b.renderStep(b.determineNextStep(b._questions[e.step]))}),this.element.on("change",".bubble__input--select, .bubble__input--radio",function(b){var c=a(this);if(console.log(c.prop("disabled")),c.data("proceed-on-change")){var d=c.parents("form");c.prop("disabled")?b.preventDefault():d.submit()}})},e.prototype.ucFirst=function(a){return a.replace(/^./,a.substring(0,1).toUpperCase())},e.prototype.determineNextStep=function(a){var b="";if(a.next.constructor===Array){for(var c=0;c<a.next.length;c++)if(a.next[c].condition()){b=a.next[c].key;break}}else b=a.next;return b},e.prototype.transformInput=function(a){for(var b in a)if(a.hasOwnProperty(b)){var c=a[b].trim();if("name"==b){var d=c.split(" ");a.firstname=this.ucFirst(d[0]),d[1]&&(a.lastname=this.ucFirst(d[1])),delete a[b]}}return a},e.prototype.renderFields=function(a,b){var c=this,d="",e=a.length,f=' data-proceed-on-change="'+(1===e?"true":"false")+'"';return a.forEach(function(a){d+='<div class="bubble__field">';var b=c._fields[a],e="bubble__input bubble__input--"+b.type,g=' name="'+a+'" class="'+e+'" ';switch(b.label&&(d+='<label class="bubble__input-label">'+b.label+"</label>"),b.type){case"text":d+="<input"+g+' type="'+b.type+'" placeholder="'+b.placeholder+'">';break;case"select":d+="<select"+g+f+">";for(var h in b.options)b.options.hasOwnProperty(h)&&(d+='<option value="'+h+'">'+b.options[h]+"</option>");d+="</select>";break;case"radio":d+='<div class="bubble__radios">';for(var h in b.options)b.options.hasOwnProperty(h)&&(d+='<input type="radio"'+g+f+'autocomplete="off" value="'+h+'" id="'+a+"--"+h+'"><label for="'+a+"--"+h+'">'+b.options[h]+"</label>");d+="</div>"}d+="</div>"}),e>1&&(d+='<button type="submit" class="bubble__button">Continue</button>'),d},e.prototype.renderStep=function(b){null==b&&(b="start");var c=this._questions[b];if(this.element.append(h.bot({bot:c.bot,userInput:this._storage})),c.prompt){var d={prompt:c.prompt,stepKey:b,userInput:this._storage};c.fields&&(d.fields=this.renderFields(c.fields,b)),this.element.append(h.user(d))}var e=this.element.find(".bubble--bot:last");"start"!==b&&a("html, body").animate({scrollTop:e.offset().top},500)},a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document);